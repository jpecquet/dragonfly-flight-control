{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://dragonfly-flight-control.local/schema/case_study.schema.json",
  "title": "CaseStudy",
  "type": "object",
  "required": [
    "schema_version",
    "case_id",
    "paper",
    "specimen",
    "simulation_defaults",
    "convention",
    "kinematics",
    "output_references"
  ],
  "properties": {
    "schema_version": {
      "type": "integer",
      "minimum": 1
    },
    "case_id": {
      "type": "string",
      "minLength": 1
    },
    "paper": {
      "type": "object",
      "required": ["citation_key"],
      "properties": {
        "citation_key": {"type": "string", "minLength": 1},
        "label": {"type": "string"}
      },
      "additionalProperties": true
    },
    "specimen": {
      "type": "object",
      "additionalProperties": {
        "type": ["number", "string", "boolean", "object", "array", "null"]
      }
    },
    "simulation_defaults": {
      "type": "object",
      "additionalProperties": {
        "type": ["number", "string", "boolean", "object", "array", "null"]
      }
    },
    "convention": {
      "type": "object",
      "required": [
        "source_world_axes",
        "source_to_sim_rotation",
        "source_angle_names",
        "sim_transforms",
        "notes"
      ],
      "properties": {
        "source_world_axes": {
          "type": "object",
          "required": ["X", "Y", "Z"],
          "additionalProperties": {"type": "string"}
        },
        "source_to_sim_rotation": {
          "type": "array",
          "minItems": 3,
          "maxItems": 3,
          "items": {
            "type": "array",
            "minItems": 3,
            "maxItems": 3,
            "items": {"type": "number"}
          }
        },
        "source_angle_names": {
          "type": "object",
          "required": ["gamma", "phi", "psi"],
          "additionalProperties": {"type": "string"}
        },
        "source_typos": {
          "type": "array",
          "items": {"type": "string"}
        },
        "sim_transforms": {
          "type": "object",
          "required": ["gamma", "phi", "psi"],
          "additionalProperties": {
            "type": "object",
            "required": ["scale", "offset_deg", "phase_shift_deg"],
            "properties": {
              "scale": {"type": "number"},
              "offset_deg": {"type": "number"},
              "phase_shift_deg": {"type": "number"}
            },
            "additionalProperties": false
          }
        },
        "notes": {
          "type": "array",
          "items": {"type": "string"}
        }
      },
      "additionalProperties": true
    },
    "kinematics": {
      "oneOf": [
        {
          "type": "object",
          "required": ["kind", "angles"],
          "properties": {
            "kind": {"const": "fourier_series_deg"},
            "angles": {
              "type": "object",
              "required": ["fore", "hind"],
              "additionalProperties": {
                "type": "object",
                "required": ["gamma", "phi", "psi"],
                "additionalProperties": {
                  "type": "object",
                  "required": ["mean_deg", "terms"],
                  "properties": {
                    "mean_deg": {"type": "number"},
                    "terms": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": ["harmonic", "amplitude_deg", "phase_deg"],
                        "properties": {
                          "harmonic": {"type": "integer", "minimum": 1},
                          "amplitude_deg": {"type": "number"},
                          "phase_deg": {"type": "number"}
                        },
                        "additionalProperties": false
                      }
                    }
                  },
                  "additionalProperties": false
                }
              }
            }
          },
          "additionalProperties": true
        },
        {
          "type": "object",
          "required": ["kind", "timeseries"],
          "properties": {
            "kind": {"const": "timeseries_csv"},
            "timeseries": {
              "type": "object",
              "required": ["csv_path", "columns"],
              "properties": {
                "csv_path": {"type": "string", "minLength": 1},
                "skip_header": {"type": "integer", "minimum": 0},
                "columns": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "object",
                    "required": ["time_col", "value_col"],
                    "properties": {
                      "time_col": {"type": "integer", "minimum": 0},
                      "value_col": {"type": "integer", "minimum": 0},
                      "units": {"type": "string"}
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": true
            }
          },
          "additionalProperties": true
        }
      ]
    },
    "output_references": {
      "type": "array",
      "items": {
        "oneOf": [
          {
            "type": "object",
            "required": ["kind", "name", "speed_m_s", "direction_deg"],
            "properties": {
              "kind": {"const": "flight_condition"},
              "name": {"type": "string", "minLength": 1},
              "speed_m_s": {"type": "number"},
              "direction_deg": {"type": "number"},
              "direction_definition": {"type": "string"}
            },
            "additionalProperties": true
          },
          {
            "type": "object",
            "required": ["kind", "name", "csv_path", "time_column", "value_column"],
            "properties": {
              "kind": {"const": "force_timeseries_csv"},
              "name": {"type": "string", "minLength": 1},
              "csv_path": {"type": "string", "minLength": 1},
              "time_column": {"type": "string", "minLength": 1},
              "value_column": {"type": "string", "minLength": 1},
              "units": {"type": "string"}
            },
            "additionalProperties": true
          }
        ]
      }
    }
  },
  "additionalProperties": true
}
