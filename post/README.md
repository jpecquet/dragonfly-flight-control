# Postprocessing Scripts

Python tools for visualizing dragonfly simulation output.

## Requirements

```bash
pip install numpy matplotlib h5py pyvista imageio imageio-ffmpeg
# For animations:
brew install ffmpeg  # macOS
```

## Assets

Wing meshes must be placed in `assets/` directory:

```
assets/
├── forewing.obj    # Forewing mesh (modeled as right wing)
└── hindwing.obj    # Hindwing mesh (modeled as right wing)
```

Mesh convention (Blender export with forward=X, up=Z):
- +X along chord (leading to trailing edge)
- -Y along span (root to tip)
- +Z normal (dorsal)

Left wings are generated by mirroring the Y coordinate.

## Scripts

### plot_simulation.py

Visualize simulation output (body + wings + force vectors).

```bash
# Animation
python -m post.plot_simulation output.h5 output.mp4
```

### plot_landscape.py

Plot optimizer objective function landscape (1D or 2D).

```bash
python -m post.plot_landscape optim_landscape.h5 landscape.png
```

### plot_wing_rotation.py

Animate wing basis vectors through rotation phases.

```bash
python -m post.plot_wing_rotation wingtest.h5 rotation.mp4
```

### plot_stick.py

Visualize wing stroke motion projected onto a sphere (equirectangular projection).

```bash
# Animate a specific wing
python -m post.plot_stick output.h5 fore_left stroke.mp4

# List available wings
python -m post.plot_stick output.h5
```

### plot_terminal_velocity.py

Visualize terminal velocity simulation results.

```bash
# Static plot
python -m post.plot_terminal_velocity --psi 45 output.png

# Animation
python -m post.plot_terminal_velocity --psi 45 output.mp4
```

### view_meshes.py

View wing meshes from assets directory (for debugging mesh orientation).

```bash
# Interactive viewer
python -m post.view_meshes

# Save to file
python -m post.view_meshes meshes.png
```

## Module Structure

```
post/
├── __init__.py              # Package init, matplotlib config
├── io.py                    # HDF5 readers
├── dragonfly.py             # 3D body/wing rendering
├── view_meshes.py           # Wing mesh viewer
├── plot_simulation.py       # CLI: simulation visualization
├── plot_landscape.py        # CLI: optimizer landscape
├── plot_wing_rotation.py    # CLI: wing rotation animation
├── plot_stick.py            # CLI: wing stroke sphere projection
└── plot_terminal_velocity.py # CLI: terminal velocity visualization
```

## Library Usage

```python
from post.io import read_simulation, read_landscape, read_wing_rotation
from post.dragonfly import plot_dragonfly

# Read and plot simulation
params, time, states, wings = read_simulation("output.h5")
plot_dragonfly(states, wings, params, "output.png")

# Read landscape data
data = read_landscape("landscape.h5")
```
